<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>Selenium 2.0 自动化测试&高级爬虫</title>

        <!-- Bootstrap Core CSS -->
        <link href="https://zqhong.github.io/pelican-blog/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="https://zqhong.github.io/pelican-blog/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="https://zqhong.github.io/pelican-blog/theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Example1：登录网易邮箱 # coding: utf8 from __future__ import print_function from selenium import webdriver from selenium.webdriver.common.by ...">

        <meta name="author" content="zqhong">

        <meta name="tags" content="Python">
        <meta name="tags" content="Selenium">
        <meta name="tags" content="自动化">
        <meta name="tags" content="测试">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="zqhong">

	<meta property="og:type" content="article">
            <meta property="article:author" content="https://zqhong.github.io/pelican-blog/author/zqhong.html">
	<meta property="og:url" content="https://zqhong.github.io/pelican-blog/selenium-2-0-automated-testing-and-professional-spider.html">
	<meta property="og:title" content="Selenium 2.0 自动化测试&高级爬虫">
	<meta property="article:published_time" content="2016-05-08 11:04:00+08:00">
            <meta property="og:description" content="Example1：登录网易邮箱 # coding: utf8 from __future__ import print_function from selenium import webdriver from selenium.webdriver.common.by ...">

            <meta property="og:image" content="https://zqhong.github.io/pelican-blog/theme/images/post-bg.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://zqhong.github.io/pelican-blog/">zqhong</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('https://zqhong.github.io/pelican-blog/theme/images/post-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Selenium 2.0 自动化测试&高级爬虫</h1>
                        <span class="meta">Posted by
                                <a href="https://zqhong.github.io/pelican-blog/author/zqhong.html">zqhong</a>
                             on Sun 08 May 2016
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <h1>Example1：登录网易邮箱</h1>
<div class="highlight"><pre><span class="err">#</span> <span class="nx">coding</span><span class="o">:</span> <span class="nx">utf8</span>

<span class="nx">from</span> <span class="nx">__future__</span> <span class="kr">import</span> <span class="nx">print_function</span>

<span class="nx">from</span> <span class="nx">selenium</span> <span class="kr">import</span> <span class="nx">webdriver</span>
<span class="nx">from</span> <span class="nx">selenium</span><span class="p">.</span><span class="nx">webdriver</span><span class="p">.</span><span class="nx">common</span><span class="p">.</span><span class="nx">by</span> <span class="kr">import</span> <span class="nx">By</span>
<span class="nx">from</span> <span class="nx">selenium</span><span class="p">.</span><span class="nx">webdriver</span><span class="p">.</span><span class="nx">support</span> <span class="kr">import</span> <span class="nx">expected_conditions</span> <span class="nx">as</span> <span class="nx">EC</span>
<span class="nx">from</span> <span class="nx">selenium</span><span class="p">.</span><span class="nx">webdriver</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">ui</span> <span class="kr">import</span> <span class="nx">WebDriverWait</span>


<span class="kr">class</span> <span class="nx">Netease</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">def</span> <span class="nx">__init__</span><span class="p">(</span><span class="nx">self</span><span class="p">)</span><span class="o">:</span>
        <span class="err">#</span> <span class="err">使用到的</span> <span class="nx">url</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">login_url</span> <span class="o">=</span> <span class="s2">&quot;http://reg.163.com/&quot;</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">account_info_url</span> <span class="o">=</span> <span class="s2">&quot;http://reg.163.com/account/accountInfo.jsp&quot;</span>

        <span class="err">#</span> <span class="err">邮箱和密码，这里使用一个没用的账号用于测试</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="s2">&quot;your_email&quot;</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">password</span> <span class="o">=</span> <span class="s2">&quot;your_password&quot;</span>

        <span class="err">#</span> <span class="err">获取</span> <span class="nx">WebDriver</span> <span class="err">对象</span>
        <span class="err">#</span> <span class="err">需要</span> <span class="nx">ChromeDriver</span> <span class="err">的支持。</span>
        <span class="err">#</span> <span class="err">根据系统下载：</span><span class="nx">http</span><span class="o">:</span><span class="c1">//chromedriver.storage.googleapis.com/index.html?path=2.21/</span>
        <span class="err">#</span> <span class="err">除了使用</span> <span class="nx">Chrome</span><span class="err">，你也可以使用</span> <span class="nx">Firefox</span><span class="err">、</span><span class="nx">IE</span><span class="err">、</span><span class="nx">Opera</span> <span class="err">等。用法差不多</span>
        <span class="nx">executable_path</span> <span class="o">=</span> <span class="s2">&quot;C:\Program Files (x86)\Google\Chrome\Application\chromedriver.exe&quot;</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span> <span class="o">=</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">Chrome</span><span class="p">(</span><span class="nx">executable_path</span><span class="o">=</span><span class="nx">executable_path</span><span class="p">)</span>

        <span class="err">#</span> <span class="err">设置默认延迟</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">delay</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">set_page_load_timeout</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">implicitly_wait</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

    <span class="nx">def</span> <span class="nx">login</span><span class="p">(</span><span class="nx">self</span><span class="p">)</span><span class="o">:</span>
        <span class="err">#</span> <span class="err">打开登陆页面</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">login_url</span><span class="p">)</span>

        <span class="err">#</span> <span class="nx">WebDriver</span> <span class="err">每次只能在一个页面上识别元素</span>
        <span class="err">#</span> <span class="err">对于</span> <span class="nx">frame</span> <span class="err">嵌套内的页面上的元素，直接定位是定位是定位不到的</span>
        <span class="err">#</span> <span class="err">需要通过</span> <span class="nx">switch_to_frame</span><span class="p">()</span> <span class="err">方法将当前定位的主体切换了</span> <span class="nx">frame</span> <span class="err">里</span>
        <span class="nx">elem_login_by_account</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">find_element</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span> <span class="s2">&quot;loginByAccount&quot;</span><span class="p">)</span>
        <span class="nx">elem_login_frame</span> <span class="o">=</span> <span class="nx">elem_login_by_account</span><span class="p">.</span><span class="nx">find_element</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;iframe&quot;</span><span class="p">)</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">switch_to</span><span class="p">.</span><span class="nx">frame</span><span class="p">(</span><span class="nx">elem_login_frame</span><span class="p">)</span>

        <span class="err">#</span> <span class="err">找到</span> <span class="nx">email</span> <span class="err">输入框、</span><span class="nx">password</span> <span class="err">输入框</span> <span class="err">和</span> <span class="err">登录按钮</span>
        <span class="nx">elem_email</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">find_element</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">NAME</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">)</span>
        <span class="nx">elem_password</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">find_element</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">NAME</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">)</span>
        <span class="nx">elem_dologin</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">find_element</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span> <span class="s2">&quot;dologin&quot;</span><span class="p">)</span>

        <span class="err">#</span> <span class="err">清除输入框内容（因为某些网站或浏览器可能会有记住用户名的功能）</span>
        <span class="nx">elem_email</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>
        <span class="nx">elem_password</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>

        <span class="err">#</span> <span class="err">输入邮箱和密码</span>
        <span class="nx">elem_email</span><span class="p">.</span><span class="nx">send_keys</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span>
        <span class="nx">elem_password</span> <span class="p">.</span><span class="nx">send_keys</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span>

        <span class="err">#</span> <span class="err">点击登陆按钮</span>
        <span class="nx">elem_dologin</span><span class="p">.</span><span class="nx">click</span><span class="p">()</span>

        <span class="err">#</span> <span class="err">等待页面加载，直到页面出现</span> <span class="nx">id</span> <span class="err">为</span> <span class="s2">&quot;accountManage&quot;</span> <span class="err">的元素</span>
        <span class="err">#</span> <span class="err">如果超过指定的时间（这里为</span> <span class="nx">self</span><span class="p">.</span><span class="nx">delay</span><span class="err">），则会抛出一个</span> <span class="nx">TimeoutException</span> <span class="err">的异常</span>
        <span class="nx">WebDriverWait</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">delay</span><span class="p">).</span><span class="nx">until</span><span class="p">(</span>
            <span class="nx">EC</span><span class="p">.</span><span class="nx">presence_of_element_located</span><span class="p">((</span><span class="nx">By</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span> <span class="s2">&quot;accountManage&quot;</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="nx">def</span> <span class="nx">run</span><span class="p">(</span><span class="nx">self</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">login</span><span class="p">()</span>

        <span class="err">#</span> <span class="err">打开用户信息页面</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">account_info_url</span><span class="p">)</span>

        <span class="err">#</span> <span class="err">打印登录用户的昵称</span>
        <span class="nx">nickname</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">find_element</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">CLASS_NAME</span><span class="p">,</span> <span class="s2">&quot;clear&quot;</span><span class="p">)</span>
        <span class="nx">print</span><span class="p">(</span><span class="nx">nickname</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span>

        <span class="err">#</span> <span class="err">退出浏览器</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">quit</span><span class="p">()</span>

<span class="k">if</span> <span class="nx">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="o">:</span>
    <span class="nx">Netease</span><span class="p">().</span><span class="nx">run</span><span class="p">()</span>
</pre></div>


<blockquote>
<p>请阅读以上代码，里面包含了 WebDriver 大部分的用法。</p>
</blockquote>
<!--more-->

<hr />
<h1>Example2：Selenium 2.0+PhantomJS</h1>
<h2>PhantomJS 简介</h2>
<p>PhantomJS is a headless WebKit scriptable with a JavaScript API. It has fast and native support for various web standards: DOM handling, CSS selector, JSON, Canvas, and SVG.</p>
<p>简单的说，PhantomJS 是个无头的（headless）浏览器。</p>
<p>下载地址：<a href="http://phantomjs.org/download.html">http://phantomjs.org/download.html</a></p>
<p>主要修改地方：</p>
<div class="highlight"><pre><span class="n">class</span> <span class="n">Netease</span><span class="p">(</span><span class="n">object</span><span class="p">)</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="err">#</span> <span class="err">省略</span> <span class="p">...</span>
        <span class="err">#</span> <span class="err">这里写上</span> <span class="n">phantomjs</span> <span class="err">的路径</span>
        <span class="n">executable_path</span> <span class="o">=</span> <span class="s">&quot;C:\Python27\phantomjs.exe&quot;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">PhantomJS</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">executable_path</span><span class="p">)</span>
        <span class="err">#</span> <span class="err">省略</span> <span class="p">...</span>

    <span class="n">def</span> <span class="n">login</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="err">#</span> <span class="err">省略</span> <span class="p">...</span>
        <span class="err">#</span> <span class="err">请看这里：</span><span class="n">https</span><span class="o">:</span><span class="c1">//github.com/detro/ghostdriver/issues/159</span>
        <span class="err">#</span> <span class="err">简单的说就是：如果</span> <span class="n">frame</span> <span class="err">元素没有</span> <span class="n">name</span> <span class="err">属性，</span><span class="n">GD</span> <span class="err">就会无法处理。</span>
        <span class="err">#</span> <span class="err">使用</span> <span class="n">driver</span><span class="p">.</span><span class="n">switch_to_frame</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="err">就能很好的解决当</span> <span class="n">iframes</span> <span class="err">没有</span> <span class="n">name</span> <span class="err">属性这个问题</span>
        <span class="n">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="err">#</span> <span class="err">省略</span> <span class="p">...</span>
</pre></div>


<hr />
<h1>Example3：登录淘宝</h1>
<div class="highlight"><pre><span class="cp"># coding: utf8</span>

<span class="n">from</span> <span class="n">selenium</span> <span class="n">import</span> <span class="n">webdriver</span>
<span class="n">from</span> <span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">by</span> <span class="n">import</span> <span class="n">By</span>
<span class="n">import</span> <span class="n">random</span>
<span class="n">import</span> <span class="n">time</span>


<span class="n">class</span> <span class="n">Alimama</span><span class="p">(</span><span class="n">object</span><span class="p">)</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">login_url</span> <span class="o">=</span> <span class="s">&quot;https://www.alimama.com/member/login.htm?forward=http%3A%2F%2Fad.alimama.com%2Findex.htm&quot;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">username</span> <span class="o">=</span> <span class="s">&quot;your_username&quot;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="s">&quot;your_password&quot;</span>

        <span class="err">#</span> <span class="n">executable_path</span> <span class="o">=</span> <span class="s">&quot;C:\Program Files (x86)\Internet Explorer\IEDriverServer.exe&quot;</span>
        <span class="n">executable_path</span> <span class="o">=</span> <span class="s">&quot;C:\Program Files (x86)\Internet Explorer\IEDriverServer_win32.exe&quot;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Ie</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">executable_path</span><span class="p">)</span>

        <span class="err">#</span> <span class="n">set</span> <span class="k">default</span> <span class="n">delay</span> <span class="n">time</span>
        <span class="n">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">set_page_load_timeout</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">random_wait</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">2.1</span> <span class="o">+</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="n">def</span> <span class="n">login</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="err">#</span> <span class="n">open</span> <span class="n">login</span> <span class="n">page</span>
        <span class="n">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">login_url</span><span class="p">)</span>

        <span class="err">#</span> <span class="k">switch</span> <span class="n">iframe</span>
        <span class="n">iframe</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s">&quot;taobaoLoginIfr&quot;</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">iframe</span><span class="p">)</span>

        <span class="err">#</span> <span class="n">find</span> <span class="n">elements</span>
        <span class="n">elem_quick2static</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">&quot;J_Quick2Static&quot;</span><span class="p">)</span>       <span class="err">#</span> <span class="err">扫一扫登录</span> <span class="err">切换到</span> <span class="err">密码登录</span>
        <span class="n">elem_username</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">&quot;TPL_username_1&quot;</span><span class="p">)</span>
        <span class="n">elem_password</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">&quot;TPL_password_1&quot;</span><span class="p">)</span>
        <span class="n">elem_login_btn</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">&quot;J_SubmitStatic&quot;</span><span class="p">)</span>

        <span class="err">#</span> <span class="err">出现</span> <span class="err">扫一扫登录</span> <span class="err">切换到</span> <span class="err">密码登录按钮，点击该按钮。切换到</span> <span class="err">密码登录</span> <span class="err">模式</span>
        <span class="k">if</span> <span class="n">elem_quick2static</span><span class="p">.</span><span class="n">is_displayed</span><span class="p">()</span><span class="o">:</span>
            <span class="n">elem_quick2static</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>

        <span class="err">#</span> <span class="n">clear</span> <span class="n">username</span> <span class="n">and</span> <span class="n">password</span>
        <span class="n">elem_username</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">elem_password</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="err">#</span> <span class="n">key</span> <span class="n">your</span> <span class="n">username</span> <span class="n">and</span> <span class="n">password</span>
        <span class="n">elem_username</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">username</span><span class="p">)</span>
        <span class="n">elem_password</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>

        <span class="err">#</span> <span class="err">等待数秒钟再登陆</span>
        <span class="n">self</span><span class="p">.</span><span class="n">random_wait</span><span class="p">()</span>
        <span class="n">elem_login_btn</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>

    <span class="n">def</span> <span class="n">run</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">login</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="err">&#39;</span><span class="n">__main__</span><span class="err">&#39;</span><span class="o">:</span>
    <span class="n">Alimama</span><span class="p">().</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<h2>使用方法</h2>
<p>使用 IE 浏览器，手动登陆一次。（第一次需要认证）接着使用程序自动登陆。</p>
<blockquote>
<p>备注：<a href="http://www.alimama.com/member/login.htm?forward=http%3A%2F%2Fad.alimama.com%2Findex.htm">http://www.alimama.com/member/login.htm?forward=http%3A%2F%2Fad.alimama.com%2Findex.htm</a> 这个登录页面不需要拖动滑块登录。</p>
</blockquote>
<h2>这里有几个我遇到的问题：</h2>
<ol>
<li>IE Driver 需要使用 32 位的，不然在 send_keys 的时候，速度异常的慢。</li>
<li>需要设置一下 IE，Internet 选项 - 安全，每个区域都需要选中 "启用保护模式"。接着重启 IE。</li>
<li>设置 IE 的字体大小为默认 （Ctrl + 0）</li>
<li>在输入完用户名和密码的时候，不要马上点击登陆。不然无法登陆成功。（请看第 54 行代码）</li>
</ol>
<hr />
<h1>WebDriver API</h1>
<h2>定位</h2>
<h3>通过 find_element*</h3>
<div class="highlight"><pre><span class="cp"># 寻找单个元素</span>
<span class="n">find_element_by_id</span><span class="p">()</span>
<span class="n">find_element_by_name</span><span class="p">()</span>
<span class="n">find_element_by_class_name</span><span class="p">()</span>
<span class="n">find_element_by_tag_name</span><span class="p">()</span>
<span class="n">find_element_by_link_text</span><span class="p">()</span>
<span class="n">find_element_by_partial_link_text</span><span class="p">()</span>
<span class="n">find_element_by_xpath</span><span class="p">()</span>
<span class="n">find_element_by_css_selector</span><span class="p">()</span>

<span class="cp"># 寻找多个元素</span>
<span class="n">find_elements_by_id</span><span class="p">()</span>
<span class="n">find_elements_by_name</span><span class="p">()</span>
<span class="n">find_elements_by_class_name</span><span class="p">()</span>
<span class="n">find_elements_by_tag_name</span><span class="p">()</span>
<span class="n">find_elements_by_link_text</span><span class="p">()</span>
<span class="n">find_elements_by_partial_link_text</span><span class="p">()</span>
<span class="n">find_elements_by_xpath</span><span class="p">()</span>
<span class="n">find_elements_by_css_selector</span><span class="p">()</span>
</pre></div>


<h3>通过 By 定位</h3>
<div class="highlight"><pre><span class="cp"># find_element()方法需要两个参数：第一个参数是定位方式，这个由 By 提供；另</span>
<span class="err">第二个参数是定位的值。</span>
<span class="cp"># 在使用 By 时需要将 By 类导入。from selenium.webdriver.common.by import By</span>

<span class="cp"># 寻找单个元素</span>
<span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span><span class="s">&quot;kw&quot;</span><span class="p">)</span>
<span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">NAME</span><span class="p">,</span><span class="s">&quot;wd&quot;</span><span class="p">)</span>
<span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span><span class="s">&quot;s_ipt&quot;</span><span class="p">)</span>
<span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">TAG_NAME</span><span class="p">,</span><span class="s">&quot;input&quot;</span><span class="p">)</span>
<span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">LINK_TEXT</span><span class="p">,</span><span class="n">u</span><span class="s">&quot;新闻&quot;</span><span class="p">)</span>
<span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span><span class="n">u</span><span class="s">&quot;新&quot;</span><span class="p">)</span>
<span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">XPATH</span><span class="p">,</span><span class="s">&quot;//*[@class=&#39;bg s_btn&#39;]&quot;</span><span class="p">)</span>
<span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span><span class="s">&quot;span.bg s_btn_wr&gt;input#su&quot;</span><span class="p">)</span>

<span class="cp"># 寻找多个元素，将 find_element 改为 find_elements</span>
</pre></div>


<h2>元素操作</h2>
<div class="highlight"><pre><span class="cp"># 方法</span>
<span class="n">clear</span><span class="p">()</span> <span class="err">清除文本，如果是一个文件输入框</span>
<span class="n">send_keys</span><span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="p">)</span> <span class="err">在元素上模拟按键输入</span>
<span class="n">click</span><span class="p">()</span> <span class="err">单击元素</span>
<span class="n">submit</span><span class="p">()</span><span class="err">方法用于提交表单，这里特别用于没提交按钮的情况。</span>

<span class="cp"># 属性</span>
<span class="n">size</span> <span class="err">返回元素的尺寸。</span>
<span class="n">text</span> <span class="err">获取元素的文本。</span>
<span class="n">get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="err">获得属性值。</span>
<span class="n">is_displayed</span><span class="p">()</span> <span class="err">设置该元素是否用户可见。</span>
</pre></div>


<h2>控制浏览器</h2>
<div class="highlight"><pre><span class="cp"># 控制浏览器大小</span>
<span class="n">driver</span><span class="p">.</span><span class="n">set_window_size</span><span class="p">(</span><span class="mi">480</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>

<span class="cp"># 控制浏览器行为</span>
<span class="cp"># 后退</span>
<span class="n">driver</span><span class="p">.</span><span class="n">back</span><span class="p">()</span>
<span class="cp"># 前进</span>
<span class="n">driver</span><span class="p">.</span><span class="n">forward</span><span class="p">()</span>
<span class="cp"># 退出</span>
<span class="n">driver</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>


<h2>鼠标事件</h2>
<div class="highlight"><pre><span class="n">perform</span><span class="p">()</span> <span class="err">执行所有</span> <span class="n">ActionChains</span> <span class="err">中存储的行为</span>
<span class="n">context_click</span><span class="p">()</span> <span class="err">右击</span>
<span class="n">double_click</span><span class="p">()</span> <span class="err">双击</span>
<span class="n">drag_and_drop</span><span class="p">()</span> <span class="err">拖动</span>
<span class="n">move_to_element</span><span class="p">()</span> <span class="err">鼠标悬停</span>
</pre></div>


<h3>一个简单的例子：右键操作</h3>
<div class="highlight"><pre><span class="cp"># 定位到要右击的元素</span>
<span class="n">right_click</span> <span class="o">=</span><span class="n">driver</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">&quot;xx&quot;</span><span class="p">)</span>
<span class="cp"># 对定位到的元素执行鼠标右键操作</span>
<span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">).</span><span class="n">context_click</span><span class="p">(</span><span class="n">right_click</span><span class="p">).</span><span class="n">perform</span><span class="p">()</span>
</pre></div>


<h2>元素等待</h2>
<h3>显式等待</h3>
<p>显式等待使 WebdDriver 等待某个条件成立时继续执行，否则在达到最大时长时抛弃超时异常
（TimeoutException）。</p>
<div class="highlight"><pre><span class="cp">#coding=utf-8</span>
<span class="n">from</span> <span class="n">selenium</span> <span class="n">import</span> <span class="n">webdriver</span>
<span class="n">from</span> <span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">by</span> <span class="n">import</span> <span class="n">By</span>
<span class="n">from</span> <span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">ui</span> <span class="n">import</span> <span class="n">WebDriverWait</span>
<span class="n">from</span> <span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">support</span> <span class="n">import</span> <span class="n">expected_conditions</span> <span class="n">as</span> <span class="n">EC</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Firefox</span><span class="p">()</span>
<span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;http://www.baidu.com&quot;</span><span class="p">)</span>
<span class="n">element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">).</span><span class="n">until</span><span class="p">(</span>
<span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span><span class="s">&quot;kw&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">element</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="err">&#39;</span><span class="n">selenium</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">driver</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>


<h3>隐式等待</h3>
<p>隐式等待是通过一定的时长等待页面所元素加载完成。哪果超出了设置的时长元素还没有被加载测抛
NoSuchElementException 异常。WebDriver 提供了 implicitly_wait()方法来实现隐式等待，默认设置为 0。它
的用法相对来说要简单的多。</p>
<div class="highlight"><pre><span class="cp">#coding=utf-8</span>
<span class="n">from</span> <span class="n">selenium</span> <span class="n">import</span> <span class="n">webdriver</span>
<span class="n">from</span> <span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">ui</span> <span class="n">import</span> <span class="n">WebDriverWait</span>


<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Firefox</span><span class="p">()</span>
<span class="n">driver</span><span class="p">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;http://www.baidu.com&quot;</span><span class="p">)</span>
<span class="n">input_</span> <span class="o">=</span> <span class="n">driver</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">&quot;kw22&quot;</span><span class="p">)</span>
<span class="n">input_</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="err">&#39;</span><span class="n">selenium</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">driver</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>


<p>implicitly_wait()默认参数的单位为秒，本例中设置等待时长为 10 秒，首先这 10 秒并非一个固定的等
待时间，它并不影响脚本的执行速度。其次，它并不真对页面上的某一元素进行等待，当脚本执行到某个
元素定位时，如果元素可定位那么继续执行，如果元素定位不到，那么它将以轮询的方式不断的判断元素
是否被定位到，假设在第 6 秒钟定位到元素则继续执行。直接超出设置时长（10 秒）还没定位到元素则抛
出异常。
在上面的例子中，显然百度输入框的定位 id=kw22 是有误的，那么在超出 10 秒后将抛出异常。</p>
<h2>多表单切换</h2>
<p>在 web 应用中经常会遇到 frame 嵌套页面的应用，页 WebDriver 每次只能在一个页面上识别元素，对
于 frame 嵌套内的页面上的元素，直接定位是定位是定位不到的。这个时候就需要通过 switch_to_frame()
方法将当前定位的主体切换了 frame 里。</p>
<div class="highlight"><pre><span class="cp">#coding=utf-8</span>
<span class="n">from</span> <span class="n">selenium</span> <span class="n">import</span> <span class="n">webdriver</span>
<span class="n">import</span> <span class="n">time</span>
<span class="n">import</span> <span class="n">os</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Firefox</span><span class="p">()</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">file</span><span class="o">:</span><span class="c1">///&#39; + os.path.abspath(&#39;frame.html&#39;)</span>
<span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
<span class="cp">#切换到 iframe（id = &quot;if&quot;）</span>
<span class="n">driver</span><span class="p">.</span><span class="n">switch_to_frame</span><span class="p">(</span><span class="s">&quot;if&quot;</span><span class="p">)</span>
<span class="cp">#下面就可以正常的操作元素了</span>
<span class="n">driver</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">&quot;kw&quot;</span><span class="p">).</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&quot;selenium&quot;</span><span class="p">)</span>
<span class="n">driver</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">&quot;su&quot;</span><span class="p">).</span><span class="n">click</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">driver</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>


<hr />
<h1>相关资料</h1>
<p><a href="http://www.seleniumhq.org/docs/03_webdriver.jsp">Selenium Document - WebDriver</a>
<a href="http://www.seleniumhq.org/docs/04_webdriver_advanced.jsp">Selenium Document - WebDriver Advanced Usage</a>
<a href="http://selenium-python.readthedocs.io/index.html">Selenium with Python</a>
<a href="http://www.cnblogs.com/fnng/p/3542333.html">Selenium2自动化测试实战--基于Python语言</a>
<a href="https://github.com/detro/ghostdriver/issues/159">Can't switch between nested frames #159 - ghostdriver Issues</a></p>
<blockquote>
<p>备注：WebDriver API 部分主要摘抄 《Selenium2自动化测试实战》 第四章内容。有兴趣的可以阅读这本书。或者看官方文档。</p>
</blockquote>
    </article>

        <div class="tags">
            <p>tags: <a href="https://zqhong.github.io/pelican-blog/tag/python.html">Python</a>, <a href="https://zqhong.github.io/pelican-blog/tag/selenium.html">Selenium</a>, <a href="https://zqhong.github.io/pelican-blog/tag/zi-dong-hua.html">自动化</a>, <a href="https://zqhong.github.io/pelican-blog/tag/ce-shi.html">测试</a></p>
        </div>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="#">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-you can add links in your config file fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-another social link fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>.
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://zqhong.github.io/pelican-blog/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="https://zqhong.github.io/pelican-blog/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="https://zqhong.github.io/pelican-blog/theme/js/clean-blog.min.js"></script>

</body>

</html>